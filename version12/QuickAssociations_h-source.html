<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>/magnus/back_end/general/include/QuickAssociations.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.6 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>/magnus/back_end/general/include/QuickAssociations.h</h1><a href="QuickAssociations_h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment"> *   $Id: QuickAssociations.h,v 1.1 1998/01/06 20:33:13 bormotov Exp $</font>
00003 <font class="comment"> */</font>
00004 
00005 <font class="comment">// Copyright (C) 1994 The New York Group Theory Cooperative</font>
00006 <font class="comment">// See magnus/doc/COPYRIGHT for the full notice.</font>
00007 
00008 <font class="comment">// Contents: Definition and implementation of</font>
00009 <font class="comment">//           template &lt;class Key, class Val&gt; class QuickAssociationsOf</font>
00010 <font class="comment">//</font>
00011 <font class="comment">// QuickAssociationsOf implements an associative array, currently with O(1)</font>
00012 <font class="comment">// access time.</font>
00013 <font class="comment">//</font>
00014 <font class="comment">// This is dp's remake of Associations class. QuickAssociations</font>
00015 <font class="comment">// class is a combination of Associations with Set (more exactly,</font>
00016 <font class="comment">// Associations interface is combined with SetData).</font>
00017 <font class="comment">//</font>
00018 <font class="comment">//</font>
00019 <font class="comment">// Principal Authors: Stephane Collart, Roger Needham, Dmitry Pechkin</font>
00020 <font class="comment">//</font>
00021 <font class="comment">// Status: in progress</font>
00022 <font class="comment">//</font>
00023 <font class="comment">// Revision History:</font>
00024 <font class="comment">//</font>
00025 <font class="comment">// * @dp 1995/07 added: int QuickAssociationsOf&lt;Key,Val&gt;::cardinality() const</font>
00026 <font class="comment">//</font>
00027 <font class="comment">// Special remarks:</font>
00028 <font class="comment">//</font>
00029 <font class="comment">// * Requirements: Key and Val must have copy constructors and destructors,</font>
00030 <font class="comment">//   Val must have operator=, and Key must have operator==.</font>
00031 <font class="comment">//   Because an QuickAssociationsOf method returns a ListOf&lt;Key&gt;, </font>
00032 <font class="comment">//   and ListOf wants to output its elements using &lt;&lt;, there must also be an</font>
00033 <font class="comment">//   ostream&amp; operator &lt;&lt; ( ostream&amp;, const Type&amp; ),</font>
00034 <font class="comment">//   and a conversion of Key to Type.</font>
00035 <font class="comment">//   @rn `inherited' requirements like this bear further consideration.</font>
00036 <font class="comment">//</font>
00037 <font class="comment">//   @dp Key must have hash() member function.</font>
00038 <font class="comment">//</font>
00039 <font class="comment">// * This copies Keys and Vals around, so non-user classes are less efficent.</font>
00040 <font class="comment">//</font>
00041 <font class="comment">// * The iterator template is parameterized by Key and Val, rather than</font>
00042 <font class="comment">//   container class type, so g++ 2.5.8 will buy it. We'll switch to the</font>
00043 <font class="comment">//   latter someday. Code which uses iterators will then break, but will be</font>
00044 <font class="comment">//   easy to fix.</font>
00045 <font class="comment">//</font>
00046 <font class="comment">// * Val QuickAssociationsOf&lt;Key,Val&gt;::operator [ ] ( const Key&amp; ) const</font>
00047 <font class="comment">//   may be enhanced later to act as an lvalue. No code will break.</font>
00048 <font class="comment">//</font>
00049 <font class="comment">// * I left out the possibly handy method</font>
00050 <font class="comment">//     Key QuickAssociationsOf&lt;Key,Val&gt;::keyOf( const Val&amp; ) const</font>
00051 <font class="comment">//   so as not to require Val to have operator==.</font>
00052 <font class="comment">//</font>
00053 <font class="comment">// * The return values of, e.g., valueOf would be more efficient as</font>
00054 <font class="comment">//   references, but that seems to make the reference count go bad.</font>
00055 <font class="comment">//</font>
00056 <font class="comment">//</font>
00057 
00058 
00059 <font class="preprocessor">#ifndef _QUICK_ASSOCIATIONS_H_</font>
00060 <font class="preprocessor"></font><font class="preprocessor">#define _QUICK_ASSOCIATIONS_H_</font>
00061 <font class="preprocessor"></font>
00062 
00063 <font class="preprocessor">#include "<a class="code" href="RefCounter_h.html">RefCounter.h</a>"</font>
00064 <font class="preprocessor">#include "<a class="code" href="ObjectOf_h.html">ObjectOf.h</a>"</font>
00065 <font class="preprocessor">#include "<a class="code" href="List_h.html">List.h</a>"</font>
00066 <font class="preprocessor">#include "<a class="code" href="Set_h.html">Set.h</a>"</font>
00067 
00068 <font class="preprocessor">#include &lt;iostream.h&gt;</font>
00069 
00070 
00071 <font class="comment">//---------------------- class QuickAssociation -------------------------</font>
00072 
00073 template &lt;class Key, class Val&gt; <font class="keyword">class </font><a class="code" href="class_QuickAssociationsRep.html">QuickAssociationsRep</a>;
00074 
<a name="l00075"></a><a class="code" href="class_QuickAssociation.html">00075</a> template &lt;class Key, class Val&gt; <font class="keyword">class </font><a class="code" href="class_QuickAssociation.html">QuickAssociation</a> {
00076 <font class="keyword">public</font>:
<a name="l00077"></a><a class="code" href="class_QuickAssociation.html#a0">00077</a>   <a class="code" href="class_QuickAssociation.html#a0">QuickAssociation</a>(<font class="keyword">const</font> Key&amp; k, <font class="keyword">const</font> Val&amp; v) : key(k) { val = <font class="keyword">new</font> Val(v); }
00078   
<a name="l00079"></a><a class="code" href="class_QuickAssociation.html#a1">00079</a>   <a class="code" href="class_QuickAssociation.html#a0">QuickAssociation</a>(<font class="keyword">const</font> <a class="code" href="class_QuickAssociation.html">QuickAssociation</a>&amp; qa) : key(qa.key) {
00080     <font class="keywordflow">if</font>( qa.val )
00081       val = <font class="keyword">new</font> Val(*qa.val);
00082     <font class="keywordflow">else</font>
00083       val = 0;
00084   }
00085 
<a name="l00086"></a><a class="code" href="class_QuickAssociation.html#a2">00086</a>   <a class="code" href="class_QuickAssociation.html">QuickAssociation</a>&amp; <a class="code" href="class_QuickAssociation.html#a2">operator=</a>( <font class="keyword">const</font> <a class="code" href="class_QuickAssociation.html">QuickAssociation</a>&amp; qa )<font class="keyword"> </font>{
00087     <font class="keywordflow">if</font>( <font class="keyword">this</font> != &amp;qa ) {
00088       key = qa.key;
00089       <font class="keywordflow">if</font>( val ) {
00090         <font class="keywordflow">if</font>( qa.val )
00091           *val = *qa.val;
00092         <font class="keywordflow">else</font> {
00093           <font class="keyword">delete</font> val;
00094           val = 0;
00095         }
00096       }
00097       <font class="keywordflow">else</font> {
00098         <font class="keywordflow">if</font>( qa.val ) 
00099           val = <font class="keyword">new</font> Val(*qa.val);
00100         <font class="keywordflow">else</font>
00101           val = 0;
00102       }
00103     }
00104     <font class="keywordflow">return</font> *<font class="keyword">this</font>;
00105   }
00106 
<a name="l00107"></a><a class="code" href="class_QuickAssociation.html#a3">00107</a>   <a class="code" href="class_QuickAssociation.html#a3">~QuickAssociation</a>()<font class="keyword"> </font>{
00108     <font class="keywordflow">if</font>( val ) {
00109       <font class="keyword">delete</font> val;
00110       val = 0;
00111     }
00112   }
00113 
<a name="l00114"></a><a class="code" href="class_QuickAssociation.html#a4">00114</a>   <font class="keywordtype">int</font> <a class="code" href="class_QuickAssociation.html#a4">hash</a>()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> <a class="code" href="class_SetData.html">SetData&lt;Key&gt;</a>(key).hashElement(key); }
00115 
<a name="l00116"></a><a class="code" href="class_QuickAssociation.html#l1">00116</a>   <font class="keyword">friend</font> <font class="keyword">inline</font> <font class="keywordtype">int</font> <a class="code" href="class_QuickAssociation.html#l1">operator ==</a>(<font class="keyword">const</font> <a class="code" href="class_QuickAssociation.html">QuickAssociation&lt;Key,Val&gt;</a>&amp; x, <font class="keyword">const</font> <a class="code" href="class_QuickAssociation.html">QuickAssociation&lt;Key,Val&gt;</a>&amp; y)<font class="keyword"> </font>{
00117     <font class="keywordflow">return</font> x.key == y.key; 
00118   }
00119 
<a name="l00120"></a><a class="code" href="class_QuickAssociation.html#m0">00120</a>   Key key;
<a name="l00121"></a><a class="code" href="class_QuickAssociation.html#m1">00121</a>   Val *val; 
00122 <font class="keyword">private</font>:
<a name="l00123"></a><a class="code" href="class_QuickAssociation.html#l0">00123</a>   <font class="keyword">friend</font> <font class="keyword">class </font><a class="code" href="class_QuickAssociationsRep.html">QuickAssociationsRep</a>&lt;Key,Val&gt;;
00124   
<a name="l00125"></a><a class="code" href="class_QuickAssociation.html#c0">00125</a>   <a class="code" href="class_QuickAssociation.html#a0">QuickAssociation</a>(<font class="keyword">const</font> Key&amp; k) : key(k), val(0) { }
00126 };
00127 
00128 template &lt;class Key, class Val&gt;
<a name="l00129"></a><a class="code" href="QuickAssociations_h.html#a0">00129</a> <font class="keyword">inline</font> ostream&amp; operator &lt;&lt;(ostream&amp; o, const QuickAssociation&lt;Key,Val&gt;&amp; qa)
00130 {
00131   o &lt;&lt; qa.key &lt;&lt; <font class="stringliteral">" : "</font> &lt;&lt; qa.val &lt;&lt; <font class="stringliteral">" "</font>;
00132   <font class="keywordflow">return</font> o;
00133 }
00134 
00135 
00136 <font class="comment">//---------------------- class QuickAssociationsRep --------------------------</font>
00137 
00138 
00139 template &lt;class Key, class Val&gt; <font class="keyword">class </font><a class="code" href="class_QuickAssociationsIteratorRep.html">QuickAssociationsIteratorRep</a>;
00140 <font class="comment">// Forward declaration for friend declarations.</font>
00141 
00142 template &lt;class Key, class Val&gt;
<a name="l00143"></a><a class="code" href="class_QuickAssociationsRep.html">00143</a> <font class="keyword">class </font><a class="code" href="class_QuickAssociationsRep.html">QuickAssociationsRep</a> : <font class="keyword">public</font> <a class="code" href="class_SetData.html">SetData</a>&lt; QuickAssociation&lt;Key,Val&gt; &gt; {
00144 
<a name="l00145"></a><a class="code" href="class_QuickAssociationsRep.html#u0">00145</a>   <font class="keyword">typedef</font> <a class="code" href="class_QuickAssociation.html">QuickAssociation&lt;Key,Val&gt;</a> <a class="code" href="class_QuickAssociation.html">EltType</a>;
00146 
00147 <font class="keyword">public</font>:
00148 
<a name="l00149"></a><a class="code" href="class_QuickAssociationsRep.html#a0">00149</a>   <a class="code" href="class_QuickAssociationsRep.html#a0">QuickAssociationsRep</a>( <font class="keywordtype">int</font> size = 1 ) : <a class="code" href="class_ObjectOf.html">Base</a> (size) {}
00150 
<a name="l00151"></a><a class="code" href="class_QuickAssociationsRep.html#a1">00151</a>   <a class="code" href="class_QuickAssociationsRep.html#a0">QuickAssociationsRep</a>( <font class="keyword">const</font> <a class="code" href="class_QuickAssociationsRep.html">QuickAssociationsRep</a>&amp; ar ) : <a class="code" href="class_ObjectOf.html">Base</a>(ar) {}
00152   <font class="comment">// Usual deep copy.</font>
00153 
00154   <font class="comment">// destructor supplied by compiler</font>
00155 
<a name="l00156"></a><a class="code" href="class_QuickAssociationsRep.html#a2">00156</a>   <a class="code" href="class_QuickAssociationsRep.html">QuickAssociationsRep</a>* <a class="code" href="class_SetData.html#a4">clone</a>( )<font class="keyword"> const </font>{ <font class="keywordflow">return</font> <font class="keyword">new</font> <a class="code" href="class_QuickAssociationsRep.html">QuickAssociationsRep&lt;Key,Val&gt;</a>(*this); }
00157 
<a name="l00158"></a><a class="code" href="class_QuickAssociationsRep.html#a3">00158</a>   <font class="keywordtype">void</font> <a class="code" href="class_QuickAssociationsRep.html#a3">unbind</a>( <font class="keyword">const</font> Key&amp; k )<font class="keyword"> </font>{
00159     <a class="code" href="class_QuickAssociation.html">EltType</a> *elt = 0;
00160     <font class="keywordflow">if</font>( <a class="code" href="class_QuickAssociationsRep.html#c0">seek</a>(k, elt) ) {
00161       <a class="code" href="class_SetData.html#a12">removeElement</a>( *elt );
00162       <font class="keyword">delete</font> elt;
00163     }
00164   }
00165 
<a name="l00166"></a><a class="code" href="class_QuickAssociationsRep.html#a4">00166</a>   <font class="keywordtype">void</font> <a class="code" href="class_QuickAssociationsRep.html#a4">bind</a>( <font class="keyword">const</font> Key&amp; k, <font class="keyword">const</font> Val&amp; v )<font class="keyword"> </font>{
00167     <a class="code" href="class_QuickAssociationsRep.html#a3">unbind</a>(k);
00168     <a class="code" href="class_SetData.html#a11">adjoinElement</a>( <a class="code" href="class_QuickAssociationsRep.html#u0">EltType</a>(k, v) );
00169   }
00170 
<a name="l00171"></a><a class="code" href="class_QuickAssociationsRep.html#a5">00171</a>   Val <a class="code" href="class_QuickAssociationsRep.html#a5">val</a>( <font class="keyword">const</font> Key&amp; k )<font class="keyword"> const </font>{
00172     <a class="code" href="class_QuickAssociation.html">EltType</a> *elt;
00173     <a class="code" href="class_QuickAssociationsRep.html#c0">seek</a>(k, elt);
00174 <font class="preprocessor">#if SAFETY &gt; 0</font>
00175 <font class="preprocessor"></font>    <font class="keywordflow">if</font> ( !elt )
00176       <a class="code" href="error_h.html#a0">error</a>(<font class="stringliteral">"called QuickAssociationsOf&lt;Key,Val&gt;::operator [ ] with unbound Key"</font>);
00177 <font class="preprocessor">#endif</font>
00178 <font class="preprocessor"></font>    Val value = *elt-&gt;val;
00179     <font class="keyword">delete</font> elt;
00180     <font class="keywordflow">return</font> value;
00181   }
00182 
<a name="l00183"></a><a class="code" href="class_QuickAssociationsRep.html#a6">00183</a>   <font class="keywordtype">bool</font> <a class="code" href="class_QuickAssociationsRep.html#a6">bound</a>( <font class="keyword">const</font> Key&amp; k )<font class="keyword"> const </font>{
00184     <a class="code" href="class_QuickAssociation.html">EltType</a> *elt;
00185     <font class="keywordflow">if</font>( <a class="code" href="class_QuickAssociationsRep.html#c0">seek</a>(k, elt) ) {
00186       <font class="keyword">delete</font> elt;
00187       <font class="keywordflow">return</font> <font class="keyword">true</font>;
00188     }
00189     <font class="keywordflow">return</font> <font class="keyword">false</font>;
00190   }
00191 
00192 <font class="keyword">private</font>:
00193 
<a name="l00194"></a><a class="code" href="class_QuickAssociationsRep.html#u1">00194</a>   <font class="keyword">typedef</font> <a class="code" href="class_SetData.html">SetData&lt; QuickAssociation&lt;Key,Val&gt;</a> &gt; <a class="code" href="class_ObjectOf.html">Base</a>;
00195 
<a name="l00196"></a><a class="code" href="class_QuickAssociationsRep.html#l0">00196</a>   <font class="keyword">friend</font> <font class="keyword">class </font><a class="code" href="class_QuickAssociationsIteratorRep.html">QuickAssociationsIteratorRep</a>&lt;Key,Val&gt;;
00197 
<a name="l00198"></a><a class="code" href="class_QuickAssociationsRep.html#c0">00198</a>   <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_QuickAssociationsRep.html#c0">seek</a>( <font class="keyword">const</font> Key&amp; k, <a class="code" href="class_QuickAssociation.html">EltType</a>* &amp;elt )<font class="keyword"> const </font>{
00199     <a class="code" href="class_QuickAssociation.html">EltType</a> qa(k);
00200     <font class="keywordtype">int</font> index = <a class="code" href="global_h.html#a7">abs</a>(<a class="code" href="class_SetData.html#a6">hashElement</a>(qa)) % numberOfBuckets;
00201     Base::CellType* search = hashTable[index];
00202     <font class="keywordflow">while</font> ( search ) {
00203       <font class="keywordflow">if</font> ( k == search-&gt;getContents().key ) {
00204         elt = <font class="keyword">new</font> <a class="code" href="class_QuickAssociationsRep.html#u0">EltType</a>(search-&gt;getContents());
00205         <font class="keywordflow">return</font> <font class="keyword">true</font>;
00206       }
00207       search = search-&gt;nextCell;
00208     }
00209     elt = 0;
00210     <font class="keywordflow">return</font> <font class="keyword">false</font>;
00211   }
00212 
00213   <font class="comment">// No data members.</font>
00214 };
00215 
00216 <font class="comment">//------------------- class QuickAssociationsOf --------------------------//</font>
00217 
00218 
00219 template &lt;class Key, class Val&gt; <font class="keyword">struct </font><a class="code" href="struct_QuickAssocRef.html">QuickAssocRef</a>;
00220 
00221 template &lt;class Key, class Val&gt;
<a name="l00222"></a><a class="code" href="class_QuickAssociationsOf.html">00222</a> <font class="keyword">class </font><a class="code" href="class_QuickAssociationsOf.html">QuickAssociationsOf</a> : <font class="keyword">public</font> <a class="code" href="class_ObjectOf.html">ObjectOf</a>&lt; QuickAssociationsRep&lt;Key,Val&gt; &gt; {
00223 
00224 <font class="keyword">public</font>:
00225 
<a name="l00226"></a><a class="code" href="class_QuickAssociationsOf.html#a0">00226</a>   <a class="code" href="class_QuickAssociationsOf.html#a0">QuickAssociationsOf</a>( ) : <a class="code" href="class_ObjectOf.html">ObjectOf</a>&lt;<a class="code" href="struct_VectorPtrRep.html">Rep</a>&gt;(new <a class="code" href="struct_VectorPtrRep.html">Rep</a>()) { }
00227   <font class="comment">// Default constructor makes an empty set of associations.</font>
00228 
00229   <font class="comment">// Copy constructor, operator=, and destructor supplied by compiler.</font>
00230 
<a name="l00231"></a><a class="code" href="class_QuickAssociationsOf.html#a1">00231</a>   Val <a class="code" href="class_QuickAssociationsOf.html#a1">operator [ ] </a>( <font class="keyword">const</font> Key&amp; k )<font class="keyword"> const </font>{ <font class="keywordflow">return</font> <a class="code" href="class_QuickAssociationsOf.html#a3">valueOf</a>(k); }
00232   <font class="comment">// Operator synonym for valueOf.</font>
00233 
00234   <a class="code" href="struct_QuickAssocRef.html">QuickAssocRef&lt;Key,Val&gt;</a> <a class="code" href="class_QuickAssociationsOf.html#a1">operator [ ] </a>( <font class="keyword">const</font> Key&amp; k );
00235 
<a name="l00236"></a><a class="code" href="class_QuickAssociationsOf.html#a3">00236</a>   Val <a class="code" href="class_QuickAssociationsOf.html#a3">valueOf</a>( <font class="keyword">const</font> Key&amp; k )<font class="keyword"> const </font>{ <font class="keywordflow">return</font> <a class="code" href="class_ObjectOf.html#b0">look</a>()-&gt;val(k); }
00237   <font class="comment">// Retrieves the Val associated with k. It is a fatal error if k is not</font>
00238   <font class="comment">// bound to any Val.</font>
00239 
<a name="l00240"></a><a class="code" href="class_QuickAssociationsOf.html#a4">00240</a>   <font class="keywordtype">void</font> <a class="code" href="class_QuickAssociationsOf.html#a4">bind</a>( <font class="keyword">const</font> Key&amp; k, <font class="keyword">const</font> Val&amp; v )<font class="keyword"> </font>{ <a class="code" href="class_ObjectOf.html#b2">change</a>()-&gt;bind(k, v); }
00241   <font class="comment">// Associates k with v. Overwrites any existing association.</font>
00242 
<a name="l00243"></a><a class="code" href="class_QuickAssociationsOf.html#a5">00243</a>   <font class="keywordtype">void</font> <a class="code" href="class_QuickAssociationsOf.html#a5">unbind</a>( <font class="keyword">const</font> Key&amp; k )<font class="keyword"> </font>{ <a class="code" href="class_ObjectOf.html#b2">change</a>()-&gt;unbind(k); }
00244   <font class="comment">// Breaks any association k has; not an error if none.</font>
00245 
<a name="l00246"></a><a class="code" href="class_QuickAssociationsOf.html#a6">00246</a>   <font class="keywordtype">bool</font> <a class="code" href="class_QuickAssociationsOf.html#a6">bound</a>( <font class="keyword">const</font> Key&amp; k )<font class="keyword"> const </font>{ <font class="keywordflow">return</font> <a class="code" href="class_ObjectOf.html#b0">look</a>()-&gt;bound(k); }
00247   <font class="comment">// Says whether k is associated with anything.</font>
00248 
<a name="l00249"></a><a class="code" href="class_QuickAssociationsOf.html#a7">00249</a>   <font class="keywordtype">int</font> <a class="code" href="class_SetData.html#a9">cardinality</a>()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> <a class="code" href="class_ObjectOf.html#b0">look</a>()-&gt;cardinality(); }
00250 
00251   <a class="code" href="class_ListOf.html">ListOf&lt;Key&gt;</a> <a class="code" href="class_QuickAssociationsOf.html#a8">keys</a>( ) <font class="keyword">const</font>;
00252   <font class="comment">// Returns a list of all keys in this association list.</font>
00253   <font class="comment">// A similar function returning all values would require Val to</font>
00254   <font class="comment">// have an operator==.</font>
00255 
00256 
00257 <font class="keyword">private</font>:
00258 
<a name="l00259"></a><a class="code" href="class_QuickAssociationsOf.html#u0">00259</a>   <font class="keyword">typedef</font> <a class="code" href="class_QuickAssociationsRep.html">QuickAssociationsRep&lt;Key,Val&gt;</a> <a class="code" href="struct_VectorPtrRep.html">Rep</a>;
00260 
<a name="l00261"></a><a class="code" href="class_QuickAssociationsOf.html#l0">00261</a>   <font class="keyword">friend</font> <font class="keyword">class </font><a class="code" href="class_QuickAssociationsIteratorRep.html">QuickAssociationsIteratorRep</a>&lt;Key,Val&gt;;
00262 };
00263 
00264 
00265 <font class="comment">//------------------------ struct QuickAssocRef ---------------------------//</font>
00266 
00267 
<a name="l00268"></a><a class="code" href="struct_QuickAssocRef.html">00268</a> template &lt;class Key, class Val&gt; <font class="keyword">struct </font><a class="code" href="struct_QuickAssocRef.html">QuickAssocRef</a> {
<a name="l00269"></a><a class="code" href="struct_QuickAssocRef.html#m0">00269</a>   <a class="code" href="class_QuickAssociationsOf.html">QuickAssociationsOf&lt;Key,Val&gt;</a>&amp; asref;
<a name="l00270"></a><a class="code" href="struct_QuickAssocRef.html#m1">00270</a>   <font class="keyword">const</font> Key key;
<a name="l00271"></a><a class="code" href="struct_QuickAssocRef.html#a0">00271</a>   <a class="code" href="struct_QuickAssocRef.html#a0">QuickAssocRef</a>( <a class="code" href="class_QuickAssociationsOf.html">QuickAssociationsOf&lt;Key,Val&gt;</a>&amp; a, <font class="keyword">const</font> Key&amp; k ) : asref(a), key(k) { }
<a name="l00272"></a><a class="code" href="struct_QuickAssocRef.html#a1">00272</a>   <font class="keyword">const</font> Val&amp; <a class="code" href="class_ObjectOf.html#a2">operator = </a>( <font class="keyword">const</font> Val&amp; val )<font class="keyword"></font>
00273 <font class="keyword">  </font>{ asref.<a class="code" href="class_QuickAssociationsOf.html#a4">bind</a>(key,val); <font class="keywordflow">return</font> val; }
<a name="l00274"></a><a class="code" href="struct_QuickAssocRef.html#a2">00274</a>   <a class="code" href="struct_QuickAssocRef.html#a2">operator Val </a>( )<font class="keyword"> </font>{ <font class="keywordflow">return</font> asref.<a class="code" href="class_QuickAssociationsOf.html#a3">valueOf</a>(key); }
<a name="l00275"></a><a class="code" href="struct_QuickAssocRef.html#a3">00275</a>   <a class="code" href="struct_QuickAssocRef.html#a3">operator void* </a>( )<font class="keyword"> </font>{ <font class="keywordflow">return</font> (<font class="keywordtype">void</font>*)asref.<a class="code" href="class_QuickAssociationsOf.html#a6">bound</a>(key); }
00276 };
00277 
00278 
00279 <font class="comment">//------------------------ QuickAssociationsOf ---------------------------//</font>
00280 <font class="comment">//---------------------- inline functions ---------------------------//</font>
00281 
00282 template &lt;class Key, class Val&gt;
<a name="l00283"></a><a class="code" href="class_QuickAssociationsOf.html#a2">00283</a> <font class="keyword">inline</font> <a class="code" href="struct_QuickAssocRef.html">QuickAssocRef&lt;Key,Val&gt;</a> <a class="code" href="class_QuickAssociationsOf.html#a1">QuickAssociationsOf&lt;Key,Val&gt;::operator [ ] </a>( <font class="keyword">const</font> Key&amp; k )<font class="keyword"></font>
00284 <font class="keyword"></font>{ <font class="keywordflow">return</font> <a class="code" href="struct_QuickAssocRef.html">QuickAssocRef&lt;Key,Val&gt;</a>(*<font class="keyword">this</font>,k); }
00285 
00286 
00287 <font class="comment">//-------------- class QuickAssociationsIteratorRep ----------------------//</font>
00288 
00289 template &lt;class Key, class Val&gt;
<a name="l00290"></a><a class="code" href="class_QuickAssociationsIteratorRep.html">00290</a> <font class="keyword">class </font><a class="code" href="class_QuickAssociationsIteratorRep.html">QuickAssociationsIteratorRep</a> : <font class="keyword">public</font> <a class="code" href="class_RefCounter.html">RefCounter</a> {
00291 
00292 <font class="keyword">public</font>:
00293 
<a name="l00294"></a><a class="code" href="class_QuickAssociationsIteratorRep.html#a0">00294</a>   <a class="code" href="class_QuickAssociationsIteratorRep.html#a0">QuickAssociationsIteratorRep</a>( <font class="keyword">const</font> <a class="code" href="class_QuickAssociationsOf.html">QuickAssociationsOf&lt;Key,Val&gt;</a>&amp; A )
00295     :   theAssociations(A) {
00296       <a class="code" href="class_QuickAssociationsIteratorRep.html#a7">reset</a>();
00297   }
00298 
00299   <font class="comment">// Use compiler's copy constructor, operator=, and destructor.</font>
00300 
<a name="l00301"></a><a class="code" href="class_QuickAssociationsIteratorRep.html#a1">00301</a>   <a class="code" href="class_QuickAssociationsIteratorRep.html">QuickAssociationsIteratorRep</a> *<a class="code" href="class_SetData.html#a4">clone</a>()<font class="keyword"> const </font>{
00302     <font class="keywordflow">return</font> <font class="keyword">new</font> <a class="code" href="class_QuickAssociationsIteratorRep.html#a0">QuickAssociationsIteratorRep</a>(*<font class="keyword">this</font>);
00303   }
00304 
<a name="l00305"></a><a class="code" href="class_QuickAssociationsIteratorRep.html#a2">00305</a>   <font class="keywordtype">bool</font> <a class="code" href="Property_h.html#a1">operator == </a>( <font class="keyword">const</font> <a class="code" href="class_QuickAssociationsIteratorRep.html">QuickAssociationsIteratorRep</a>&amp; QAIR )<font class="keyword"> const </font>{
00306     <font class="keywordflow">return</font> ( current == QAIR.current &amp;&amp;
00307              theAssociations.<a class="code" href="class_ObjectOf.html#b0">look</a>() == QAIR.theAssociations.<a class="code" href="class_ObjectOf.html#b0">look</a>() );
00308   }
00309   <font class="comment">// @rn compare theAssociations cell-by-cell?</font>
00310   <font class="comment">// We do not want logical == of theAssociations, since iteration order</font>
00311   <font class="comment">// would be different.</font>
00312 
00313 
<a name="l00314"></a><a class="code" href="class_QuickAssociationsIteratorRep.html#a3">00314</a>   Key <a class="code" href="class_QuickAssociationsIteratorRep.html#a3">key</a>( )<font class="keyword"> const </font>{
00315 <font class="preprocessor">#if SAFETY &gt; 0</font>
00316 <font class="preprocessor"></font>    <font class="keywordflow">if</font> ( current == NULL )
00317       <a class="code" href="error_h.html#a0">error</a>(<font class="stringliteral">"tried to retrieve key from QuickAssociationsIterator which is done"</font>);
00318 <font class="preprocessor">#endif</font>
00319 <font class="preprocessor"></font>    <font class="keywordflow">return</font> current-&gt;<a class="code" href="class_Cell.html#a6">getContents</a>().key;
00320   }
00321 
<a name="l00322"></a><a class="code" href="class_QuickAssociationsIteratorRep.html#a4">00322</a>   Val <a class="code" href="class_QuickAssociationsIteratorRep.html#a4">value</a>( )<font class="keyword"> const </font>{
00323 <font class="preprocessor">#if SAFETY &gt; 0</font>
00324 <font class="preprocessor"></font>    <font class="keywordflow">if</font> ( current == NULL )
00325       <a class="code" href="error_h.html#a0">error</a>(<font class="stringliteral">"tried to retrieve value from QuickAssociationsIterator which is done"</font>);
00326 <font class="preprocessor">#endif</font>
00327 <font class="preprocessor"></font>    <font class="keywordflow">return</font> *current-&gt;<a class="code" href="class_Cell.html#a6">getContents</a>().val;
00328   }
00329 
<a name="l00330"></a><a class="code" href="class_QuickAssociationsIteratorRep.html#a5">00330</a>   <font class="keywordtype">bool</font> <a class="code" href="class_QuickAssociationsIteratorRep.html#a5">next</a>( )<font class="keyword"> </font>{
00331     <font class="keywordflow">if</font> ( current != NULL )
00332       current = current-&gt;nextCell;
00333     <font class="keywordflow">if</font> ( current == NULL ) {
00334       <font class="keywordtype">int</font> numberOfBuckets = theAssociations.<a class="code" href="class_ObjectOf.html#b0">look</a>()-&gt;numberOfBuckets;
00335       <font class="keywordflow">if</font> ( bucketIndex &gt;= numberOfBuckets ) <font class="keywordflow">return</font> 0;
00336       <a class="code" href="class_Cell.html">CellType</a>** hashTable = theAssociations.<a class="code" href="class_ObjectOf.html#b0">look</a>()-&gt;hashTable;
00337       ++bucketIndex;
00338       <font class="keywordflow">while</font> ( bucketIndex &lt; numberOfBuckets &amp;&amp; hashTable[bucketIndex] == NULL )
00339         ++bucketIndex;
00340       <font class="keywordflow">if</font> ( bucketIndex &lt; numberOfBuckets )
00341         current = hashTable[bucketIndex];
00342     }
00343     <font class="keywordflow">return</font> (current != NULL);
00344   }
00345 
<a name="l00346"></a><a class="code" href="class_QuickAssociationsIteratorRep.html#a6">00346</a>   <font class="keywordtype">bool</font> <a class="code" href="class_QuickAssociationsIteratorRep.html#a6">done</a>( )<font class="keyword"> const </font>{ <font class="keywordflow">return</font> (current == NULL); }
00347 
<a name="l00348"></a><a class="code" href="class_QuickAssociationsIteratorRep.html#a7">00348</a>   <font class="keywordtype">void</font> <a class="code" href="class_QuickAssociationsIteratorRep.html#a7">reset</a>( )<font class="keyword"> </font>{
00349     current = NULL;
00350     bucketIndex = -1;
00351     <a class="code" href="class_QuickAssociationsIteratorRep.html#a5">next</a>();
00352   }
00353 
00354 
00355 <font class="keyword">protected</font>:
00356 
<a name="l00357"></a><a class="code" href="class_QuickAssociationsIteratorRep.html#t0">00357</a>   <font class="keyword">typedef</font> <a class="code" href="class_Cell.html">Cell&lt; QuickAssociation&lt;Key,Val&gt;</a> &gt; <a class="code" href="class_Cell.html">CellType</a>;
00358 
00359   <font class="comment">// Data members:</font>
00360 
<a name="l00361"></a><a class="code" href="class_QuickAssociationsIteratorRep.html#n0">00361</a>   <a class="code" href="class_Cell.html">CellType</a>*      current;
<a name="l00362"></a><a class="code" href="class_QuickAssociationsIteratorRep.html#n1">00362</a>   <font class="keywordtype">int</font>            bucketIndex;
00363 
<a name="l00364"></a><a class="code" href="class_QuickAssociationsIteratorRep.html#n2">00364</a>   <font class="keyword">const</font> <a class="code" href="class_QuickAssociationsOf.html">QuickAssociationsOf&lt;Key,Val&gt;</a> theAssociations;
00365 
00366   <font class="comment">// If theSet is declared as SetOf&lt;T&gt;, g++ 2.5.8 &amp; 2.6.0 claim that it</font>
00367   <font class="comment">// has incomplete type. Then why, prithee, is this ok?</font>
00368   <font class="comment">// The exact same scheme works in ListOf and AssociationsOf.</font>
00369 };
00370 
00371 
00372 <font class="comment">//---------------------- class QuickAssociationsIterator ---------------------</font>
00373 
00374 
00375 <font class="comment">// Example of use:</font>
00376 <font class="comment">//</font>
00377 <font class="comment">//  QuickAssociationsOf&lt;Chars,Word&gt; wordTable;</font>
00378 <font class="comment">//  Word w;</font>
00379 <font class="comment">//  ...</font>
00380 <font class="comment">//</font>
00381 <font class="comment">//  // Remove all associations with w from wordTable:</font>
00382 <font class="comment">//</font>
00383 <font class="comment">//  QuickAssociationsIterator&lt;Chars,Word&gt; I(wordTable);</font>
00384 <font class="comment">//</font>
00385 <font class="comment">//  while ( !I.done() ) {</font>
00386 <font class="comment">//    if ( I.value() == G ) wordTable.unbind( I.key() );</font>
00387 <font class="comment">//    I.next();</font>
00388 <font class="comment">//  }</font>
00389 
00390 <font class="comment">// Note: You may alter the AssociationsOf over which you are iterating,</font>
00391 <font class="comment">//       but the iterator uses the `old' copy.</font>
00392 
<a name="l00393"></a><a class="code" href="class_QuickAssociationsIterator.html">00393</a> template &lt;class Key, class Val&gt; <font class="keyword">class </font><a class="code" href="class_QuickAssociationsIterator.html">QuickAssociationsIterator</a> :
00394 <font class="keyword">public</font> <a class="code" href="class_ObjectOf.html">ObjectOf</a>&lt; QuickAssociationsIteratorRep&lt;Key,Val&gt; &gt; {
00395 
00396 <font class="keyword">public</font>:
00397 
<a name="l00398"></a><a class="code" href="class_QuickAssociationsIterator.html#a0">00398</a>   <a class="code" href="class_QuickAssociationsIterator.html#a0">QuickAssociationsIterator</a>(<font class="keyword">const</font> <a class="code" href="class_QuickAssociationsOf.html">QuickAssociationsOf&lt;Key,Val&gt;</a>&amp; A) :
00399     <a class="code" href="class_ObjectOf.html">ObjectOf</a>&lt;<a class="code" href="class_AssociationsIteratorRep.html">AIR</a>&gt;( new <a class="code" href="class_AssociationsIteratorRep.html">AIR</a>(A) ) { }
00400   <font class="comment">// Initialize an iterator with the Associations over which to iterate.</font>
00401 
00402   <font class="comment">// Copy constructor, operator=, and destructor supplied by compiler.</font>
00403 
00404   <font class="comment">// Copying or assigning an iterator is guaranteed to produce an</font>
00405   <font class="comment">// iterator which visits the (rest of the) same elements in the</font>
00406   <font class="comment">// same order as the original.</font>
00407 
<a name="l00408"></a><a class="code" href="class_QuickAssociationsIterator.html#a1">00408</a>   <font class="keywordtype">bool</font> <a class="code" href="Property_h.html#a1">operator == </a>( <font class="keyword">const</font> <a class="code" href="class_QuickAssociationsIterator.html">QuickAssociationsIterator</a>&amp; I )<font class="keyword"> const </font>{
00409     <font class="keywordflow">return</font> ((<a class="code" href="class_ObjectOf.html#b0">look</a>() == I.<a class="code" href="class_ObjectOf.html#b0">look</a>()) || (*<a class="code" href="class_ObjectOf.html#b0">look</a>() == *I.<a class="code" href="class_ObjectOf.html#b0">look</a>()));
00410   }
00411 
<a name="l00412"></a><a class="code" href="class_QuickAssociationsIterator.html#a2">00412</a>   Key <a class="code" href="class_QuickAssociationsIterator.html#a2">key</a>( )<font class="keyword"> const </font>{ <font class="keywordflow">return</font> <a class="code" href="class_ObjectOf.html#b0">look</a>()-&gt;key(); }
00413   <font class="comment">// Returns key of current association. Calling this is a fatal error</font>
00414   <font class="comment">// if done().</font>
00415 
<a name="l00416"></a><a class="code" href="class_QuickAssociationsIterator.html#a3">00416</a>   Val <a class="code" href="class_QuickAssociationsIterator.html#a3">value</a>( )<font class="keyword"> const </font>{ <font class="keywordflow">return</font> <a class="code" href="class_ObjectOf.html#b0">look</a>()-&gt;value(); }
00417   <font class="comment">// Returns value of current association. Calling this is a fatal error</font>
00418   <font class="comment">// if done().</font>
00419 
<a name="l00420"></a><a class="code" href="class_QuickAssociationsIterator.html#a4">00420</a>   <font class="keywordtype">bool</font> <a class="code" href="class_QuickAssociationsIterator.html#a4">next</a>( )<font class="keyword"> </font>{ <font class="keywordflow">return</font> <a class="code" href="class_ObjectOf.html#b2">change</a>()-&gt;next(); }
00421   <font class="comment">// Advances this iterator.</font>
00422   <font class="comment">// Returns TRUE iff the iteration has not finished.</font>
00423   <font class="comment">// This may be called after it returns FALSE with no side effect.</font>
00424 
<a name="l00425"></a><a class="code" href="class_QuickAssociationsIterator.html#a5">00425</a>   <font class="keywordtype">bool</font> <a class="code" href="class_QuickAssociationsIterator.html#a5">done</a>( )<font class="keyword"> const </font>{ <font class="keywordflow">return</font> <a class="code" href="class_ObjectOf.html#b0">look</a>()-&gt;done(); }
00426   <font class="comment">// Returns TRUE iff the iteration has finished. This may</font>
00427   <font class="comment">// be called after it returns TRUE with no side effect.</font>
00428 
<a name="l00429"></a><a class="code" href="class_QuickAssociationsIterator.html#a6">00429</a>   <font class="keywordtype">void</font> <a class="code" href="class_QuickAssociationsIterator.html#a6">reset</a>( )<font class="keyword"> </font>{ <a class="code" href="class_ObjectOf.html#b2">change</a>()-&gt;reset(); }
00430   <font class="comment">// Resets this iterator to the state it was in after construction.</font>
00431 
00432   <font class="comment">// @stc the following are added as a tentative supplementary</font>
00433   <font class="comment">// convenience</font>
<a name="l00434"></a><a class="code" href="class_QuickAssociationsIterator.html#a7">00434</a>   <a class="code" href="class_QuickAssociationsIterator.html">QuickAssociationsIterator</a>&amp; <a class="code" href="class_QuickAssociationsIterator.html#a7">operator ++ </a>( )<font class="keyword"> </font>{ <a class="code" href="class_QuickAssociationsIterator.html#a4">next</a>(); <font class="keywordflow">return</font> *<font class="keyword">this</font>; }
<a name="l00435"></a><a class="code" href="class_QuickAssociationsIterator.html#a8">00435</a>   <a class="code" href="class_QuickAssociationsIterator.html">QuickAssociationsIterator</a> <a class="code" href="class_QuickAssociationsIterator.html#a7">operator ++ </a>( <font class="keywordtype">int</font> )<font class="keyword"> </font>{
00436     <a class="code" href="class_QuickAssociationsIterator.html">QuickAssociationsIterator</a> old = *<font class="keyword">this</font>;
00437     <a class="code" href="class_QuickAssociationsIterator.html#a4">next</a>( );
00438     <font class="keywordflow">return</font> old;
00439   } <font class="comment">// @stc need to check whether the semantics of this one are consistent</font>
00440   <font class="comment">// ie. does cloning preserve iterator semantics?</font>
<a name="l00441"></a><a class="code" href="class_QuickAssociationsIterator.html#a9">00441</a>   <a class="code" href="class_QuickAssociationsIterator.html#a9">operator void* </a>( )<font class="keyword"> </font>{ <font class="keywordflow">return</font> (<font class="keywordtype">void</font>*)!<a class="code" href="class_QuickAssociationsIterator.html#a5">done</a>(); }
00442 
00443 <font class="keyword">private</font>:
00444 
<a name="l00445"></a><a class="code" href="class_QuickAssociationsIterator.html#u0">00445</a>   <font class="keyword">typedef</font> <a class="code" href="class_QuickAssociationsIteratorRep.html">QuickAssociationsIteratorRep&lt;Key,Val&gt;</a> <a class="code" href="class_AssociationsIteratorRep.html">AIR</a>;
00446 };
00447 
00448 
00449 <font class="comment">//-------------------------- QuickAssociations -----------------------------//</font>
00450 <font class="comment">//----------------------- associated functions ------------------------//</font>
00451 
00452 template &lt;class Key, class Val&gt; <font class="keyword">inline</font> ostream&amp; <font class="keyword">operator</font> &lt;&lt;
<a name="l00453"></a><a class="code" href="QuickAssociations_h.html#a1">00453</a> ( ostream&amp; o, <font class="keyword">const</font> <a class="code" href="class_QuickAssociationsOf.html">QuickAssociationsOf&lt;Key,Val&gt;</a>&amp; a ) {
00454 
00455   <a class="code" href="class_QuickAssociationsIterator.html">QuickAssociationsIterator&lt;Key,Val&gt;</a> iter(a);
00456   o &lt;&lt; <font class="stringliteral">"-"</font>;
00457   <font class="keywordflow">while</font> (iter) {
00458     o &lt;&lt; <font class="stringliteral">"["</font> &lt;&lt; iter.<a class="code" href="class_QuickAssociationsIterator.html#a2">key</a>() &lt;&lt; <font class="stringliteral">":"</font> &lt;&lt; iter.<a class="code" href="class_QuickAssociationsIterator.html#a3">value</a>() &lt;&lt; <font class="stringliteral">"]"</font> &lt;&lt; <font class="stringliteral">"-"</font>;
00459     ++iter;
00460   }
00461   <font class="keywordflow">return</font> o;
00462 }
00463 <font class="comment">// @stc inlined here (instead of defintion in .C) to circumvent g++</font>
00464 <font class="comment">// template problems</font>
00465 
00466 
00467 <font class="comment">//---------------------- methods which iterate -----------------------------</font>
00468 
00469 template &lt;class Key, class Val&gt;
<a name="l00470"></a><a class="code" href="class_QuickAssociationsOf.html#a8">00470</a> <font class="keyword">inline</font> <a class="code" href="class_ListOf.html">ListOf&lt;Key&gt;</a> <a class="code" href="class_QuickAssociationsOf.html#a8">QuickAssociationsOf&lt;Key,Val&gt;::keys</a>( )<font class="keyword"> const</font>
00471 <font class="keyword"></font>
00472 <font class="keyword"></font>{
00473   <a class="code" href="class_ListOf.html">ListOf&lt;Key&gt;</a> result;
00474   <a class="code" href="class_QuickAssociationsIterator.html">QuickAssociationsIterator&lt;Key,Val&gt;</a> I(*<font class="keyword">this</font>);
00475   <font class="keywordflow">while</font> ( !I.<a class="code" href="class_QuickAssociationsIterator.html#a5">done</a>() ) {
00476     result.<a class="code" href="class_ListOf.html#a15">append</a>( I.<a class="code" href="class_QuickAssociationsIterator.html#a2">key</a>() );
00477     I.<a class="code" href="class_QuickAssociationsIterator.html#a4">next</a>();
00478   }
00479   <font class="keywordflow">return</font> result;
00480 }
00481 
00482 <font class="preprocessor">#endif</font>
</font></pre></div><hr><address><small>Generated at Tue Jun 19 09:49:35 2001 for Magnus Classes by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.6 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
