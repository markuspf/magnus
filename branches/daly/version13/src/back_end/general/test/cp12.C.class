// Contents: Computer Project 12
//           
//
// Principal Authors: Dmitry Bormotov
//


#include "global.h"
#include "Random.h"

void main( )
{
  /*
  UniformRandom r(23152);
  const int lambda = 4; 
  int count = 0;
  const int size = 20;
  double time[size];
  
  while( count < size ) {
    double t = r.rand() * 20;
    if( 20 * r.rand() <= lambda * exp(-lambda * t) ) {
      cout << t << "  " << lambda * exp(-lambda * t) << endl;
      time[count++] = t;;
    }
  }

  double mean = 0;
  for( int i = 0; i < size; ++i )
    mean += time[i];
  mean /= size;

  cout << endl << "mean = " << mean << endl;
  */


  const int numOfCustomers = 10;
  const double lambda[numOfCustomers] = {3.14,7,8,10,14,22,24,27,28,30};
  double t[numOfCustomers], u[numOfCustomers];
  double service[numOfCustomers], departure[numOfCustomers];
  t[0] = lambda[0];
  for( int i = 1; i < numOfCustomers; ++i )
    t[i] = lambda[i] - lambda[i-1];
  const double x[numOfCustomers] = {12-3.14,1,3,4,1,3,1,5,1,2};
  u[numOfCustomers-1] = 0;
  for( int i = 0; i < numOfCustomers-1; ++i )
    u[i] = x[i] - t[i+1];
  
  double time = lambda[0];
  int customer = 0;

  while( true ) {
    service[customer] = time;
    time += x[customer];
    departure[customer] = time;
    ++customer;
    if( customer >= numOfCustomers ) break;
    if( lambda[customer] > time )
      time = lambda[customer];
  }
  
  double w[numOfCustomers], s[numOfCustomers];
  for( int i = 0; i < numOfCustomers; ++i ) {
    w[i] = service[i] - lambda[i];
    s[i] = departure[i] - lambda[i];
  }
 
  double v[numOfCustomers];
  for( int i = 0; i < numOfCustomers; ++i ) {
    v[i] = 0;
    for( int j = 0; j < numOfCustomers; ++j ) 
      if( lambda[j] > service[i] && lambda[j] < departure[i] )
	++v[i];
  }
    
  double g[numOfCustomers];
  for( int i = 0; i < numOfCustomers; ++i ) {
    g[i] = 0;
    for( int j = 0; j < numOfCustomers; ++j ) 
      if( lambda[j] < departure[i] && departure[j] > departure[i] )
	++g[i];
  }
    
  double g1[numOfCustomers];
  for( int i = 0; i < numOfCustomers; ++i ) {
    g1[i] = 0;
    for( int j = 0; j < numOfCustomers; ++j ) 
      if( lambda[j] < lambda[i] && departure[j] > lambda[i] )
	++g1[i];
  }

  double v1[numOfCustomers];
  v1[0] = 0;
  for( int i = 1; i < numOfCustomers; ++i ) {
    v1[i] = 0;
    for( int j = 0; j < numOfCustomers; ++j ) 
      if( departure[j] > lambda[i-1] && departure[j] < lambda[i] )
	++v1[i];
  }
    

  for( int i = 0; i < numOfCustomers; ++i ) {
    cout << "n = " << i+1;
    if( i < 9 ) cout << " ";
    cout << " lambda_n = " << lambda[i] << "  t_n = " << t[i]
	 << "  x_n = " << x[i] << "  u_n = " << u[i] << "  w_n = " << w[i] 
	 << "  s_n = " << s[i] << endl << endl
	 << "       v_n = " << v[i] << "  g_n = " << g[i]
	 << "  g'_n = " << g1[i] << "  v'_n+1 = " << v1[i]
      // << "  service = " << service[i] << "  departure = " << departure[i]
	 << endl << endl << endl; 
  }
}


