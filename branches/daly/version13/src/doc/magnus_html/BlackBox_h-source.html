<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>/magnus/back_end/general/include/BlackBox.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.6 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>/magnus/back_end/general/include/BlackBox.h</h1><a href="BlackBox_h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment"> *   $Id: BlackBox.h,v 1.2 1997/02/03 22:50:30 alex Exp $</font>
00003 <font class="comment"> */</font>
00004 
00005 <font class="comment">// Copyright (C) 1994 The New York Group Theory Cooperative</font>
00006 <font class="comment">// See magnus/doc/COPYRIGHT for the full notice.</font>
00007 
00008 <font class="comment">// Contents: Definition of the BlackBox class.</font>
00009 <font class="comment">//           A BlackBox is a wrapper for an external binary which communicates</font>
00010 <font class="comment">//           exclusively through its standard I/O.</font>
00011 <font class="comment">//           The binary must accept some sort of `quit' command from its</font>
00012 <font class="comment">//           standard input.</font>
00013 <font class="comment">//</font>
00014 <font class="comment">// Principal Author: Roger Needham</font>
00015 <font class="comment">//</font>
00016 <font class="comment">// Status: experimental</font>
00017 <font class="comment">//</font>
00018 <font class="comment">// Revision History:</font>
00019 
00020 <font class="preprocessor">#ifndef _BLACKBOX_H_</font>
00021 <font class="preprocessor"></font><font class="preprocessor">#define _BLACKBOX_H_</font>
00022 <font class="preprocessor"></font>
00023 
00024 <font class="preprocessor">#include &lt;sys/types.h&gt;</font>
00025 <font class="preprocessor">#include &lt;sys/stat.h&gt;</font>
00026 
00027 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00028 <font class="preprocessor">#include &lt;unistd.h&gt;</font>
00029 <font class="preprocessor">#include &lt;string.h&gt;</font>
00030 
00031 <font class="preprocessor">#include &lt;iostream.h&gt;</font>
00032 <font class="preprocessor">#include &lt;strstream.h&gt;</font>
00033 <font class="preprocessor">#include &lt;fstream.h&gt;</font>
00034 <font class="preprocessor">#include &lt;stdiostream.h&gt;</font>
00035 
00036 <font class="preprocessor">#include "<a class="code" href="global_h.html">global.h</a>"</font>
00037 <font class="preprocessor">#include "<a class="code" href="Chars_h.html">Chars.h</a>"</font>
00038 
00039 <font class="keyword">extern</font> <font class="stringliteral">"C"</font> {
00040   <font class="keywordtype">char</font>* <a class="code" href="KBmagPackage_h.html#a0">tempnam</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>*,<font class="keyword">const</font> <font class="keywordtype">char</font>*); <font class="comment">// Lib functions SunOS doesn't declare.</font>
00041 }
00042 
00043 <font class="comment"></font>
00044 <font class="comment">/*!           A BlackBox is a wrapper for an external binary which communicates</font>
00045 <font class="comment">           exclusively through its standard I/O.</font>
00046 <font class="comment">           The binary must accept some sort of `quit' command from its</font>
00047 <font class="comment">           standard input. </font>
00048 <font class="comment">*/</font>
<a name="l00049"></a><a class="code" href="class_BlackBox.html">00049</a> <font class="keyword">class </font><a class="code" href="class_BlackBox.html">BlackBox</a> {
00050 
00051 <font class="keyword">public</font>:
00052 
00053   <a class="code" href="class_BlackBox.html#a0">BlackBox</a>(<font class="keyword">const</font> <a class="code" href="class_Chars.html">Chars</a>&amp; startCommand, <font class="keyword">const</font> <a class="code" href="class_Chars.html">Chars</a>&amp; restartCommand);<font class="comment"></font>
00054 <font class="comment">  /*!&lt; Instantiate a BlackBox by supplying sh commands which start and</font>
00055 <font class="comment">   restart the executable. The executable is actually invoked by the</font>
00056 <font class="comment">   start and restart methods. */</font>
00057 
00058   <a class="code" href="class_BlackBox.html#a0">BlackBox</a>(<font class="keyword">const</font> <a class="code" href="class_Chars.html">Chars</a>&amp; startCommand);<font class="comment"></font>
00059 <font class="comment">  /*!&lt; A version of the above where the restart command is the same as the</font>
00060 <font class="comment">    start command, or undesired. */</font>
00061 
00062   <a class="code" href="class_BlackBox.html#a2">~BlackBox</a>( );<font class="comment"></font>
00063 <font class="comment">  /*!&lt; Unlink the pipes, thus killing the executable. */</font>
00064 
00065   Bool <a class="code" href="class_BlackBox.html#a3">start</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* greeting = NULL);<font class="comment"></font>
00066 <font class="comment">  /*!&lt; Invoke the executable with the startCommand argument to the constructor.</font>
00067 <font class="comment">   This attaches named pipes to the executable's standard i/o.</font>
00068 <font class="comment">   The arg is a (possibly proper) prefix of the first non-blank line you</font>
00069 <font class="comment">   expect the binary to write to cout. We might use regexps some day.</font>
00070 <font class="comment">   This returns TRUE iff it finds the greeting (if not NULL), and all other</font>
00071 <font class="comment">   initialization was successful.</font>
00072 <font class="comment">   If you call this a second time, it just returns the status: TRUE == good. */</font>
00073 
00074   Bool <a class="code" href="class_BlackBox.html#a4">restart</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* greeting = NULL);<font class="comment"></font>
00075 <font class="comment">  /*!&lt; Unlink the pipes which were attached by start or any previous restart,</font>
00076 <font class="comment">   thus killing the executable. Invoke the executable again with the</font>
00077 <font class="comment">   restartCommand argument to the constructor, and re-attach the pipes.</font>
00078 <font class="comment">   The arg is the same as for start.</font>
00079 <font class="comment">   If you call this before you call start, it fails and returns FALSE. */</font>
00080 
00081   Bool <a class="code" href="class_BlackBox.html#a5">stillRunning</a>( );<font class="comment"></font>
00082 <font class="comment">  /*!&lt; This attempts to determine whether the executable is still running. */</font>
00083   <font class="comment">//@rn It makes no real attempt yet.</font>
00084 
00085   <font class="comment">//@rn Maybe there's a better way to do this:</font>
00086 
00087   ostream&amp; <a class="code" href="class_BlackBox.html#a6">toCommand</a>( );<font class="comment"></font>
00088 <font class="comment">  /*!&lt; Returns an ostream bound to the binary's standard input. */</font>
00089 
00090   istream&amp; <a class="code" href="class_BlackBox.html#a7">fromCommand</a>( );<font class="comment"></font>
00091 <font class="comment">  /*!&lt; Returns an istream bound to the binary's standard output.*/</font>
00092 
00093 
00094 <font class="keyword">private</font>:
00095 
00096   <font class="comment">// Data members:</font>
00097 
<a name="l00098"></a><a class="code" href="class_BlackBox.html#o0">00098</a>   <font class="keywordtype">int</font> status;                  <font class="comment">//!&lt; 1 means good, 0 means bad.</font>
<a name="l00099"></a><a class="code" href="class_BlackBox.html#o1">00099</a> <font class="comment"></font>  Bool started_p;              <font class="comment">//!&lt; Set to TRUE when start is attempted.</font>
00100 <font class="comment"></font>
<a name="l00101"></a><a class="code" href="class_BlackBox.html#o2">00101</a>   <a class="code" href="class_Chars.html">Chars</a> theStartCmd;           <font class="comment">//!&lt; sh command to start executable</font>
<a name="l00102"></a><a class="code" href="class_BlackBox.html#o3">00102</a> <font class="comment"></font>  <a class="code" href="class_Chars.html">Chars</a> theRestartCmd;         <font class="comment">//!&lt; sh command to restart executable</font>
00103 <font class="comment"></font>
<a name="l00104"></a><a class="code" href="class_BlackBox.html#o4">00104</a>   ofstream* streamToCommand;   <font class="comment">//!&lt; Bound to command's cin, or NULL</font>
<a name="l00105"></a><a class="code" href="class_BlackBox.html#o5">00105</a> <font class="comment"></font>  ifstream* streamFromCommand; <font class="comment">//!&lt; Bound to command's cout, or NULL</font>
00106 <font class="comment"></font>
00107 <font class="comment">//  char fyle_in[L_tmpnam];      // Name of pipe bound to command's cin</font>
00108 <font class="comment">//  char fyle_out[L_tmpnam];     // Name of pipe bound to command's cout</font>
<a name="l00109"></a><a class="code" href="class_BlackBox.html#o6">00109</a>   <font class="keywordtype">char</font> fyle_in[100];      <font class="comment">//!&lt; Name of pipe bound to command's cin</font>
<a name="l00110"></a><a class="code" href="class_BlackBox.html#o7">00110</a> <font class="comment"></font>  <font class="keywordtype">char</font> fyle_out[100];     <font class="comment">//!&lt; Name of pipe bound to command's cout</font>
00111 <font class="comment"></font>
00112 
00113   <font class="comment">// Private functions:</font>
00114 
00115   <font class="keywordtype">void</font> <a class="code" href="class_BlackBox.html#c0">initialize</a>(<font class="keyword">const</font> <a class="code" href="class_Chars.html">Chars</a>&amp; startCommand, <font class="keyword">const</font> <a class="code" href="class_Chars.html">Chars</a>&amp; restartCommand);
00116   Bool <a class="code" href="class_BlackBox.html#c1">doStart</a>(<font class="keyword">const</font> <a class="code" href="class_Chars.html">Chars</a>&amp; command, <font class="keyword">const</font> <font class="keywordtype">char</font>* greeting);
00117   <font class="keywordtype">void</font> <a class="code" href="class_BlackBox.html#c2">closeStreams</a>( );
00118   Bool <a class="code" href="class_BlackBox.html#c3">checkGreeting</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* greeting);
00119 
00120   <font class="comment">// Hide these:</font>
00121 
<a name="l00122"></a><a class="code" href="class_BlackBox.html#c4">00122</a>   <a class="code" href="class_BlackBox.html#a0">BlackBox</a>(<font class="keyword">const</font> <a class="code" href="class_BlackBox.html">BlackBox</a>&amp;)<font class="keyword"> </font>{
00123          <a class="code" href="error_h.html#a0">error</a>(<font class="stringliteral">"called BlackBox copy constructor"</font>);
00124   }<font class="comment"></font>
00125 <font class="comment">  //!&lt; Copy constructor is prohibited</font>
<a name="l00126"></a><a class="code" href="class_BlackBox.html#c5">00126</a> <font class="comment"></font>  <a class="code" href="class_BlackBox.html">BlackBox</a>&amp; <a class="code" href="class_BlackBox.html#c5">operator = </a>( <font class="keyword">const</font> <a class="code" href="class_BlackBox.html">BlackBox</a>&amp; )<font class="keyword"> </font>{
00127          <a class="code" href="error_h.html#a0">error</a>(<font class="stringliteral">"called BlackBox op="</font>);
00128   }<font class="comment"></font>
00129 <font class="comment">  //!&lt; Assignment operator is prohibited</font>
00130 <font class="comment"></font>  
00131 };
00132 
00133 <font class="preprocessor">#endif</font>
00134 <font class="preprocessor"></font>
00135 
</pre></div><hr><address><small>Generated at Tue Jun 19 09:49:35 2001 for Magnus Classes by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.6 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
